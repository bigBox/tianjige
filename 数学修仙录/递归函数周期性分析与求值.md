# 递归函数周期性分析与求值

## 问题描述

例5 定义域为正整数集的函数$f$满足：

$$f(n) = \begin{cases}
    n - 3, & n \geq 1000 \\
    f(f(n + 7)), & n < 1000
\end{cases}$$

求$f(90)$的值。

## 问题分析

这是一个递归定义的函数，对于较小的输入（n < 1000），函数值通过嵌套递归调用计算，而对于较大的输入（n ≥ 1000），函数值直接通过简单的线性运算得出。我们需要找到函数的周期性或某种规律，以便计算f(90)。

首先，我们可以尝试计算一些较大的n值（接近1000），看看是否能发现规律。

## 探索函数规律

### 计算n ≥ 1000的情况

当n ≥ 1000时，f(n) = n - 3，这部分很直接。

### 计算接近1000的n值

我们从n = 999开始，逐步向下计算：

- f(999) = f(f(1006)) = f(1006 - 3) = f(1003) = 1003 - 3 = 1000
- f(998) = f(f(1005)) = f(1005 - 3) = f(1002) = 1002 - 3 = 999
- f(997) = f(f(1004)) = f(1004 - 3) = f(1001) = 1001 - 3 = 998
- f(996) = f(f(1003)) = f(1003 - 3) = f(1000) = 1000 - 3 = 997
- f(995) = f(f(1002)) = f(1002 - 3) = f(999) = 1000（根据上面计算的f(999)=1000）
- f(994) = f(f(1001)) = f(1001 - 3) = f(998) = 999（根据上面计算的f(998)=999）
- f(993) = f(f(1000)) = f(1000 - 3) = f(997) = 998（根据上面计算的f(997)=998）
- f(992) = f(f(999)) = f(1000) = 997（根据上面计算的f(999)=1000）
- f(991) = f(f(998)) = f(999) = 1000（根据上面计算的f(998)=999）
- f(990) = f(f(997)) = f(998) = 999（根据上面计算的f(997)=998）

### 发现周期性

从上面的计算中，我们可以观察到一个模式：

- f(999) = 1000
- f(998) = 999
- f(997) = 998
- f(996) = 997
- f(995) = 1000
- f(994) = 999
- f(993) = 998
- f(992) = 997
- ...

看起来，当n < 1000时，函数f(n)呈现出周期性，周期为4。具体来说：

- 当n ≡ 3 (mod 4) 时，f(n) = 1000
- 当n ≡ 2 (mod 4) 时，f(n) = 999
- 当n ≡ 1 (mod 4) 时，f(n) = 998
- 当n ≡ 0 (mod 4) 时，f(n) = 997

### 验证周期性

让我们验证这个周期模式是否正确：

假设对于某个k ≥ 993，有：
- f(k) = 1000
- f(k-1) = 999
- f(k-2) = 998
- f(k-3) = 997

那么：
- f(k-4) = f(f(k-4+7)) = f(f(k+3)) = f(f(k-1)) = f(999) = 1000
- f(k-5) = f(f(k-5+7)) = f(f(k+2)) = f(f(k-2)) = f(998) = 999
- f(k-6) = f(f(k-6+7)) = f(f(k+1)) = f(f(k-3)) = f(997) = 998
- f(k-7) = f(f(k-7+7)) = f(f(k)) = f(1000) = 997

这验证了周期为4的模式确实成立。

## 计算f(90)

现在我们需要确定90在模4下的余数，以应用我们发现的周期模式：

90 ÷ 4 = 22 余 2，即90 ≡ 2 (mod 4)

根据我们的周期模式：
- 当n ≡ 2 (mod 4) 时，f(n) = 999

因此，f(90) = 999

## 严格证明

为了确保我们的结论正确，让我们进行更严格的证明。我们将使用数学归纳法证明：对于所有n ≤ 999，当n ≡ r (mod 4) 时，f(n) = 1000 - (r + 1) % 4，其中r = 0, 1, 2, 3。

### 归纳基例

我们已经计算了从992到999的值，验证了基例的正确性：
- 992 ≡ 0 (mod 4)，f(992) = 997 = 1000 - 3
- 993 ≡ 1 (mod 4)，f(993) = 998 = 1000 - 2
- 994 ≡ 2 (mod 4)，f(994) = 999 = 1000 - 1
- 995 ≡ 3 (mod 4)，f(995) = 1000 = 1000 - 0
- 996 ≡ 0 (mod 4)，f(996) = 997 = 1000 - 3
- 997 ≡ 1 (mod 4)，f(997) = 998 = 1000 - 2
- 998 ≡ 2 (mod 4)，f(998) = 999 = 1000 - 1
- 999 ≡ 3 (mod 4)，f(999) = 1000 = 1000 - 0

### 归纳步骤

假设对于所有k > n（其中n ≤ 995），当k ≡ r (mod 4) 时，f(k) = 1000 - (r + 1) % 4。

现在我们需要证明对于n，同样的模式成立。

当n < 1000时，f(n) = f(f(n + 7))。

n + 7 > n，所以根据归纳假设，我们可以计算f(n + 7)：

如果n ≡ 0 (mod 4)，则n + 7 ≡ 3 (mod 4)，所以f(n + 7) = 1000

如果n ≡ 1 (mod 4)，则n + 7 ≡ 0 (mod 4)，所以f(n + 7) = 997

如果n ≡ 2 (mod 4)，则n + 7 ≡ 1 (mod 4)，所以f(n + 7) = 998

如果n ≡ 3 (mod 4)，则n + 7 ≡ 2 (mod 4)，所以f(n + 7) = 999

接下来，我们需要计算f(f(n + 7))：

1. 当n ≡ 0 (mod 4)时：
   f(n) = f(1000) = 997 = 1000 - 3 = 1000 - (0 + 1) % 4 - 2？ 等等，我需要重新检查这个推导。

让我重新整理一下。我们观察到的模式是：
- 当n ≡ 0 (mod 4) 时，f(n) = 997
- 当n ≡ 1 (mod 4) 时，f(n) = 998
- 当n ≡ 2 (mod 4) 时，f(n) = 999
- 当n ≡ 3 (mod 4) 时，f(n) = 1000

现在让我们重新进行归纳步骤：

1. 当n ≡ 0 (mod 4)时：
   n + 7 ≡ 3 (mod 4)，所以f(n + 7) = 1000
   f(n) = f(1000) = 997，符合模式

2. 当n ≡ 1 (mod 4)时：
   n + 7 ≡ 0 (mod 4)，所以f(n + 7) = 997
   f(n) = f(997) = 998，符合模式（因为997 ≡ 1 (mod 4)）

3. 当n ≡ 2 (mod 4)时：
   n + 7 ≡ 1 (mod 4)，所以f(n + 7) = 998
   f(n) = f(998) = 999，符合模式（因为998 ≡ 2 (mod 4)）

4. 当n ≡ 3 (mod 4)时：
   n + 7 ≡ 2 (mod 4)，所以f(n + 7) = 999
   f(n) = f(999) = 1000，符合模式（因为999 ≡ 3 (mod 4)）

因此，通过数学归纳法，我们证明了对于所有n ≤ 999，函数f(n)满足上述周期为4的模式。

## 结论

由于90 ≡ 2 (mod 4)，根据我们证明的周期模式，f(90) = 999。

## 补充说明

这个问题的关键在于发现函数的周期性。递归函数f(n) = f(f(n + 7))在n < 1000时会不断将参数增加7，直到达到或超过1000，然后开始减少。通过计算接近1000的值，我们发现了周期为4的规律，这使得我们能够计算任何较小的n值，包括f(90)。

这种类型的递归函数问题通常需要通过观察模式和使用数学归纳法来解决，而不是直接展开递归调用，因为直接展开会导致大量的计算步骤。